C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg51.h>
   2          #include "LCDh.h"
   3          #include <stdio.h>
   4          #include <intrins.h>
   5          
   6          sbit DS1302_CE = P3^5; // DS1302 chip enable pin
   7          sbit DS1302_CLK = P3^6; // DS1302 clock pin
   8          sbit DS1302_IO = P3^4; // DS1302 data I/O pin
   9          
  10          // DS1302 commands
  11          #define DS1302_READ_BURST 0xBF
  12          #define DS1302_WRITE_BURST 0xBE
  13          #define DS1302_SECONDS 0x80
  14          #define DS1302_SECONDS_read 0x81
  15          #define DS1302_MINUTES 0x82
  16          #define DS1302_MINUTES_read 0x83
  17          #define DS1302_HOURS   0x84
  18          #define DS1302_HOURS_read  0x85
  19          #define DS1302_DATE    0x86
  20          #define DS1302_MONTH   0x88
  21          #define DS1302_DAY     0x8A
  22          #define DS1302_YEAR    0x8C
  23          #define DS1302_CONTROL 0x8E
  24          #define DS1302_CHARGER 0x90
  25          #define DS1302_RAMBURST_READ 0xFF
  26          #define DS1302_RAMBURST_WRITE 0xFE
  27          #define CLK_DELAY 10
  28          
  29          
  30          
  31          void Write_Byte(unsigned char cmd, unsigned int Value);
  32          unsigned char Read_Byte(unsigned char cmd);
  33          void DS1302_SetTime(unsigned int hour,  unsigned char minute, unsigned int second);
  34          void DS1302_SetDate(unsigned char day,  unsigned char month,  unsigned char year);
  35          void DS1302_GetTime(unsigned int hour, unsigned int minute, unsigned int second);
  36          void DS1302_GetDate(unsigned int *day, unsigned int *month, unsigned int *year);
  37          void Send_Bit(unsigned int bitt);
  38          void DS1302_init();
  39          
  40              char timeString[9];
  41          
  42          
  43          void main()
  44          {
  45   1          unsigned char hour, minute, second;
  46   1          unsigned char day, month, year;
  47   1          char timeString[9];
  48   1          int datestring[12]; 
  49   1          unsigned char decimalSecond;  
  50   1          unsigned char decimalMinute;
  51   1          unsigned char decimalHour;
  52   1        
  53   1          lcd_init();         // Initialize the LCD
  54   1          DS1302_init();        // Initialize ds1302
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 2   

  55   1        
  56   1           // Set initial time and date
  57   1           //DS1302_SetDate(10, 11, 2001); 
  58   1              DS1302_SetTime(11, 03, 01); 
  59   1      
  60   1          while (1)
  61   1          {   
  62   2              // Read time from DS1302
  63   2              DS1302_GetTime(&hour, &minute, &second);
*** WARNING C214 IN LINE 63 OF main.c: 'Argument': conversion: pointer to non-pointer
*** WARNING C214 IN LINE 63 OF main.c: 'Argument': conversion: pointer to non-pointer
*** WARNING C214 IN LINE 63 OF main.c: 'Argument': conversion: pointer to non-pointer
  64   2             // DS1302_GetDate(&day, &month, &year);
  65   2              
  66   2              decimalHour = (hour >> 4) * 10 + (hour & 0x0F);
  67   2              decimalMinute = (minute >> 4) * 10 + (minute & 0x0F);
  68   2              decimalSecond = (second >> 4) * 10 + (second & 0x0F);
  69   2      
  70   2              sprintf(timeString, "%02u:%02u:%02u", decimalHour,decimalMinute ,decimalSecond);
  71   2              //lcd_clear();
  72   2              lcd_set_cursor(0, 0);
  73   2              lcd_write_string("Time:");
  74   2              lcd_set_cursor(0, 5);
  75   2              lcd_write_string(timeString);          // Display the time on the LCD
  76   2              
  77   2              
  78   2      //        // Format the date string
  79   2      //        sprintf(datestring, "%02u:%02u:%04u", day, month, year);
  80   2      //       
  81   2      //        lcd_set_cursor(1, 0);
  82   2      //        lcd_write_string("Date:");
  83   2      //        lcd_set_cursor(1, 5);
  84   2      //        lcd_write_string(datestring);
  85   2      
  86   2                delay_ms(1000);                                // Wait for one second
  87   2      
  88   2          }
  89   1      }
*** WARNING C280 IN LINE 46 OF main.c: 'day': unreferenced local variable
*** WARNING C280 IN LINE 46 OF main.c: 'month': unreferenced local variable
*** WARNING C280 IN LINE 46 OF main.c: 'year': unreferenced local variable
*** WARNING C280 IN LINE 48 OF main.c: 'datestring': unreferenced local variable
  90          
  91          
  92          void DS1302_init()
  93          {
  94   1        
  95   1        DS1302_CE = 1;
  96   1        DS1302_IO = 1;
  97   1        DS1302_CLK = 0;
  98   1        
  99   1      }
 100          
 101          // Function to send a bit to the DS1302
 102          void Send_Bit(bit bitt)
 103          {
*** WARNING C235 IN LINE 103 OF main.c: parameter 1: different types
 104   1          if(bitt==1)
 105   1            {
 106   2          
 107   2            DS1302_IO = 1;
 108   2          }
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 3   

 109   1          else
 110   1            {
 111   2            DS1302_IO = 0;
 112   2          }
 113   1      }
 114          
 115          // Function to generate a clock pulse
 116          void SCLK_Pulse()
 117          {
 118   1          DS1302_CLK = 1;
 119   1          _nop_();
 120   1          _nop_();
 121   1          DS1302_CLK = 0;
 122   1          _nop_();
 123   1          _nop_();
 124   1      }
 125          
 126          
 127          void write_byte(unsigned char byte)
 128          {
 129   1          unsigned char i; bit Bit;
 130   1          
 131   1          for (i = 0; i < 8; i++)
 132   1          {
 133   2              DS1302_CLK = 0;
 134   2              Bit = byte & (1 << i); // Get each bit
 135   2              Send_Bit(Bit);         // Send the bit
 136   2              SCLK_Pulse();        // Generate clock pulse
 137   2              DS1302_CLK = 1;
 138   2          }
 139   1      }
 140          
 141          
 142          // Function to write a byte to the DS1302unsigned char cmd,
 143          void DS1302_WriteByte(unsigned char cmd, unsigned char Value)
 144          {
 145   1          DS1302_CE = 1;
 146   1          DS1302_CLK = 0;
 147   1        
 148   1          write_byte(cmd);
 149   1          write_byte(Value);
 150   1      
 151   1          DS1302_CE = 1;
 152   1          DS1302_CLK = 1;
 153   1      }
 154          
 155          void read_byte(unsigned int cmd)
 156          {
 157   1            unsigned int j,Bit;
 158   1      
 159   1           for (j = 0; j < 8; j++)
 160   1          {     
 161   2          DS1302_CLK = 1;
 162   2            
 163   2              Bit = cmd & (1 << j);       // Get each bit of cmd
 164   2              Send_Bit(Bit);             // Send the bit
 165   2              SCLK_Pulse();             // Generate clock pulse
 166   2              DS1302_CLK = 0;
 167   2      
 168   2          }
 169   1          
 170   1          
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 4   

 171   1        }
 172          // Function to read a byte from the DS1302
 173          unsigned int DS1302_ReadByte(unsigned int cmd)
 174          {
 175   1          unsigned int dat=0, j;
 176   1          DS1302_CE =1;
 177   1          DS1302_CLK = 1;
 178   1        
 179   1          read_byte(cmd);
 180   1          write_byte(cmd);
 181   1          write_byte(DS1302_RAMBURST_READ);
 182   1      
 183   1          // Receive the data byte
 184   1          for (j = 0; j < 8; j++)
 185   1          {
 186   2              dat >>= 1;
 187   2              if (DS1302_IO)
 188   2              {
 189   3                  dat |= 0x80;     // Set the corresponding bit in R
 190   3              }
 191   2              else
 192   2              {
 193   3                  dat &= 0x7F;    // Clear the corresponding bit in R
 194   3              }
 195   2      
 196   2              SCLK_Pulse();       // Generate clock pulse
 197   2          }
 198   1      
 199   1          DS1302_CE = 1;
 200   1          DS1302_CLK = 0;
 201   1      
 202   1          DS1302_IO = 0; // Set the I/O pin back to output mode
 203   1      
 204   1          return dat;
 205   1      }
 206          
 207          
 208          
 209          void DS1302_SetTime(unsigned int hour, unsigned int minute, unsigned int second)
 210          {
*** WARNING C235 IN LINE 210 OF main.c: parameter 2: different types
 211   1      
 212   1          sprintf(timeString, "%02u:%02u:%02u", hour, minute, second);
 213   1          // lcd_clear();
 214   1          lcd_set_cursor(1, 0);
 215   1          lcd_write_string("Time:");
 216   1          lcd_set_cursor(1, 5);
 217   1          lcd_write_string(timeString); 
 218   1        
 219   1          DS1302_WriteByte(0x8E,0x00); // Control Register Address, Write mode
 220   1          DS1302_WriteByte(DS1302_SECONDS,second);
 221   1          DS1302_WriteByte(DS1302_MINUTES,minute);
 222   1          DS1302_WriteByte(DS1302_HOURS,hour);
 223   1              
 224   1      }
 225          
 226          
 227          
 228          // Function to read the time from DS1302
 229          void DS1302_GetTime(unsigned char *hour, unsigned char *minute, unsigned char *second)
 230          {
*** WARNING C235 IN LINE 230 OF main.c: parameter 1: different types
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 5   

*** WARNING C235 IN LINE 230 OF main.c: parameter 2: different types
*** WARNING C235 IN LINE 230 OF main.c: parameter 3: different types
 231   1           //DS1302_ReadByte();
 232   1          *second = DS1302_ReadByte(DS1302_SECONDS);
 233   1          *minute = DS1302_ReadByte(DS1302_MINUTES);
 234   1          *hour = DS1302_ReadByte(DS1302_HOURS);
 235   1      }
 236          
 237          // Function to set the date in DS1302
 238          void DS1302_SetDate(unsigned int day, unsigned int month, unsigned int year)
 239          {
*** WARNING C235 IN LINE 239 OF main.c: parameter 1: different types
*** WARNING C235 IN LINE 239 OF main.c: parameter 2: different types
*** WARNING C235 IN LINE 239 OF main.c: parameter 3: different types
 240   1        
 241   1          DS1302_WriteByte( day);
*** WARNING C209 IN LINE 241 OF main.c: '_DS1302_WriteByte': too few actual parameters
 242   1          DS1302_WriteByte( month);
*** WARNING C209 IN LINE 242 OF main.c: '_DS1302_WriteByte': too few actual parameters
 243   1          DS1302_WriteByte( year);
*** WARNING C209 IN LINE 243 OF main.c: '_DS1302_WriteByte': too few actual parameters
 244   1      }
 245          
 246          
 247           //Function to read the date from DS1302
 248          void DS1302_GetDate(unsigned char *day, unsigned char *month, unsigned char *year)
 249          {
*** WARNING C235 IN LINE 249 OF main.c: parameter 1: different types
*** WARNING C235 IN LINE 249 OF main.c: parameter 2: different types
*** WARNING C235 IN LINE 249 OF main.c: parameter 3: different types
 250   1          *day = DS1302_ReadByte(DS1302_DATE);
 251   1          *month = DS1302_ReadByte(DS1302_MONTH);
 252   1          *year = DS1302_ReadByte(DS1302_YEAR);
 253   1      }
 254          
 255          
 256          
 257          // /***************************************************************************/ 
 258          //#ifndef _REAL_TIMER_DS1302_2003_7_21_ 
 259          //#define _REAL_TIMER_DS1302_2003_7_21_ 
 260          // 
 261          //#define  DS1302_CLK  P1_7              //ÊµÊ±Ê±ÖÓÊ±ÖÓÏßÒý½Å  
 262          //#define  DS1302_IO  P1_6              //ÊµÊ±Ê±ÖÓÊý¾ÝÏßÒý½Å  
 263          //#define  DS1302_RST  P1_5              //ÊµÊ±Ê±ÖÓ¸´Î»ÏßÒý½Å 
 264          //sbit  ACC0  = ACC^0 ;
 265          //sbit  ACC7  = ACC^7  ;
 266          // 
 267          //typedef struct __SYSTEMTIME__ 
 268          //{ 
 269          //unsigned char Second; 
 270          //unsigned char Minute; 
 271          //unsigned char Hour; 
 272          //unsigned char Week; 
 273          //unsigned char Day; 
 274          //unsigned char Month; 
 275          //unsigned char  Year; 
 276          //unsigned char DateString[9]; 
 277          //unsigned char TimeString[9]; 
 278          //}SYSTEMTIME; //¶¨ÒåµÄÊ±¼äÀàÐÍ 
 279          // 
 280          //#define AM(X) X 
 281          //#define PM(X) (X+12)               // ×ª³É24Ð¡Ê±ÖÆ 
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 6   

 282          //#define DS1302_SECOND 0x80  
 283          //#define DS1302_SECOND_READ 0x81 
 284          //#define DS1302_MINUTE 0x82
 285          //#define DS1302_MINUTE_READ 0x83 
 286          //#define DS1302_HOUR 0x84
 287          //#define DS1302_HOUR_READ 0x85  
 288          //#define DS1302_WEEK 0x8A
 289          //#define DS1302_WEEK_READ 0x8B
 290          //#define DS1302_DAY 0x86 
 291          //#define DS1302_DAY_READ 0x87 
 292          //#define DS1302_MONTH 0x88 
 293          //#define DS1302_MONTH_READ 0x89 
 294          //#define DS1302_YEAR 0x8C 
 295          //#define DS1302_YEAR_READ    0x8D 
 296          //#define DS1302_RAM(X) (0xC0+(X)*2)    //ÓÃÓÚ¼ÆËã DS1302_RAM µØÖ·µÄºê
 297          // 
 298          // 
 299          //void DS1302InputByte(unsigned char d)  //ÊµÊ±Ê±ÖÓÐ´ÈëÒ»×Ö½Ú(ÄÚ²¿º¯Êý) 
 300          //{  
 301          //    unsigned char i; 
 302          //    ACC = d; 
 303          //    for(i=8; i>0; i–) 
 304          //    { 
 305          //        DS1302_IO = ACC0;            //Ïàµ±ÓÚ»ã±àÖÐµÄ RRC 
 306          //        DS1302_CLK = 1; 
 307          //        DS1302_CLK = 0; 
 308          //        ACC = ACC >> 1;  
 309          //    }  
 310          //} 
 311          // 
 312          //unsigned char DS1302OutputByte(void)  //ÊµÊ±Ê±ÖÓ¶ÁÈ¡Ò»×Ö½Ú(ÄÚ²¿º¯Êý) 
 313          //{  
 314          //    unsigned char i; 
 315          //    for(i=8; i>0; i–) 
 316          //    { 
 317          //        ACC = ACC >>1;          //Ïàµ±ÓÚ»ã±àÖÐµÄ RRC  
 318          //        ACC7 = DS1302_IO; 
 319          //        DS1302_CLK = 1; 
 320          //        DS1302_CLK = 0; 
 321          //    }  
 322          //    return(ACC);  
 323          //} 
 324          // 
 325          //void Write1302(unsigned char ucAddr, unsigned char ucDa) //ucAddr: DS1302µØÖ·, ucData: ÒªÐ´µÄÊý¾Ý 
 326          //{   
 327          //    DS1302_CLK = 0; 
 328          //    DS1302_RST = 1; 
 329          //    DS1302InputByte(ucAddr);        // µØÖ·£¬ÃüÁî  
 330          //    DS1302InputByte(ucDa);        // Ð´1ByteÊý¾Ý  
 331          //    DS1302_CLK = 1; 
 332          //    DS1302_RST = 0;   
 333          //}  
 334          // 
 335          //unsigned char Read1302(unsigned char ucAddr) //¶ÁÈ¡DS1302Ä³µØÖ·µÄÊý¾Ý 
 336          //{ 
 337          //    unsigned char ucData;  
 338          //    DS1302_CLK = 0; 
 339          //    DS1302_RST = 1; 
 340          //    DS1302InputByte(ucAddr);        // µØÖ·£¬ÃüÁî  
 341          //    ucData = DS1302OutputByte();         // ¶Á1ByteÊý¾Ý 
 342          //    DS1302_CLK = 1; 
 343          //    DS1302_RST = 0; 
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 7   

 344          //    return(ucData); 
 345          //} 
 346          // 
 347          //void DS1302_SetProtect(bit flag)        //ÊÇ·ñÐ´±£»¤ 
 348          //{ 
 349          //if(flag) 
 350          //Write1302(0x8E,0x80); 
 351          //else 
 352          //Write1302(0x8E,0x00); 
 353          //} 
 354          // 
 355          //void DS1302_SetTime(unsigned char Address, unsigned char Value)        // ÉèÖÃÊ±¼äº¯Êý 
 356          //{ 
 357          //DS1302_SetProtect(0);  
 358          //Write1302(Address, ((Value/10)<<4 | (Value%10)));
 359          //DS1302_SetProtect(1); 
 360          //} 
 361          // 
 362          //void DS1302_GetTime(SYSTEMTIME *Time) 
 363          //{ 
 364          //unsigned char ReadValue; 
 365          //ReadValue = Read1302(DS1302_SECOND_READ); 
 366          //Time->Second = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F); 
 367          //ReadValue = Read1302(DS1302_MINUTE_READ); 
 368          //Time->Minute = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F); 
 369          //ReadValue = Read1302(DS1302_HOUR_READ); 
 370          //Time->Hour = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F); 
 371          //ReadValue = Read1302(DS1302_DAY_READ); 
 372          //Time->Day = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F); 
 373          //ReadValue = Read1302(DS1302_WEEK_READ); 
 374          //Time->Week = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F); 
 375          //ReadValue = Read1302(DS1302_MONTH_READ); 
 376          //Time->Month = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F); 
 377          //ReadValue = Read1302(DS1302_YEAR_READ); 
 378          //Time->Year = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F); 
 379          //} 
 380          // 
 381          //void DateToStr(SYSTEMTIME *Time) 
 382          //{ 
 383          //Time->DateString[0] = Time->Year/10 + '0'; 
 384          //Time->DateString[1] = Time->Year%10 + '0'; 
 385          //Time->DateString[2] = '-'; 
 386          //Time->DateString[3] = Time->Month/10 + '0'; 
 387          //Time->DateString[4] = Time->Month%10 + '0'; 
 388          //Time->DateString[5] = '-'; 
 389          //Time->DateString[6] = Time->Day/10 + '0'; 
 390          //Time->DateString[7] = Time->Day%10 + '0'; 
 391          //Time->DateString[8] = ''; 
 392          //} 
 393          // 
 394          //void TimeToStr(SYSTEMTIME *Time) 
 395          //{ 
 396          //Time->TimeString[0] = Time->Hour/10 + '0'; 
 397          //Time->TimeString[1] = Time->Hour%10 + '0'; 
 398          //Time->TimeString[2] = ':'; 
 399          //Time->TimeString[3] = Time->Minute/10 + '0'; 
 400          //Time->TimeString[4] = Time->Minute%10 + '0'; 
 401          //Time->TimeString[5] = ':'; 
 402          //Time->TimeString[6] = Time->Second/10 + '0'; 
 403          //Time->TimeString[7] = Time->Second%10 + '0'; 
 404          //Time->DateString[8] = ''; 
 405          //} 
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 8   

 406          // 
 407          ///*  
 408          //void Initial_DS1302(void) 
 409          //{ 
 410          //unsigned char Second=Read1302(DS1302_SECOND); 
 411          //if(Second&0x80)    
 412          //DS1302_SetTime(DS1302_SECOND,0); 
 413          //} 
 414          // 
 415          //void BurstWrite1302(unsigned char *pWClock) //ÍùDS1302Ð´ÈëÊ±ÖÓÊý¾Ý(¶à×Ö½Ú·½Ê½) 
 416          //{ 
 417          //    unsigned char i; 
 418          //    Write1302(0x8e,0x00);          // ¿ØÖÆÃüÁî,WP=0,Ð´²Ù×÷? 
 419          //    DS1302_RST = 0; 
 420          //    DS1302_CLK = 0; 
 421          //    DS1302_RST = 1; 
 422          //    DS1302InputByte(0xbe);         // 0xbe:Ê±ÖÓ¶à×Ö½ÚÐ´ÃüÁî 
 423          //    for (i = 8; i>0; i–)      //8Byte = 7Byte Ê±ÖÓÊý¾Ý + 1Byte ¿ØÖÆ 
 424          //    { 
 425          //        DS1302InputByte(*pWClock);  // Ð´1ByteÊý¾Ý 
 426          //        pWClock++; 
 427          //    } 
 428          //    DS1302_CLK = 1; 
 429          //    DS1302_RST = 0; 
 430          //}*/
 431          ///******************************************************************************** 
 432          //void BurstRead1302(unsigned char *pRClock) //¶ÁÈ¡DS1302Ê±ÖÓÊý¾Ý(Ê±ÖÓ¶à×Ö½Ú·½Ê½) 
 433          //{ 
 434          //    unsigned char i; 
 435          //    DS1302_RST = 0; 
 436          //    DS1302_CLK = 0; 
 437          //    DS1302_RST = 1; 
 438          //    DS1302InputByte(0xbf);              // 0xbf:Ê±ÖÓ¶à×Ö½Ú¶ÁÃüÁî  
 439          //    for (i=8; i>0; i–)  
 440          //    { 
 441          //       *pRClock = DS1302OutputByte();   // ¶Á1ByteÊý¾Ý  
 442          //       pRClock++; 
 443          //    } 
 444          //    DS1302_CLK = 1; 
 445          //    DS1302_RST = 0; 
 446          //} 
 447          // 
 448          //*/
 449          // 
 450          //void DS1302_TimeStop(bit flag)           // ÊÇ·ñ½«Ê±ÖÓÍ£Ö¹ 
 451          //{ 
 452          //unsigned char Data; 
 453          //Data=Read1302(DS1302_SECOND_READ); 
 454          //DS1302_SetProtect(0); 
 455          //if(flag) 
 456          //Write1302(DS1302_SECOND, Data|0x80); 
 457          //else 
 458          //Write1302(DS1302_SECOND, Data&0x7F); 
 459          //DS1302_SetProtect(1);
 460          //} 
 461          // 
 462          //#endif
 463          // 
 464           


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.60.7.0   MAIN                                                              08/31/2023 16:00:44 PAGE 9   

   CODE SIZE        =    754    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =      9      72
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  21 WARNING(S),  0 ERROR(S)
